# gses2-app API обміну BTC на UAH

![Docker](https://img.shields.io/badge/docker-%230db7ed.svg?style=for-the-badge&logo=docker&logoColor=white) ![Go](https://img.shields.io/badge/go-%2300ADD8.svg?style=for-the-badge&logo=go&logoColor=white)

## Переклад

- [English](README.md).

## Зміст

- [Про проект](https://chat.openai.com/?model=gpt-4#%D0%BF%D1%80%D0%BE-%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%82)
- [Встановлення](https://chat.openai.com/?model=gpt-4#%D0%B2%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BB%D0%B5%D0%BD%D0%BD%D1%8F)
- [Використання](https://chat.openai.com/?model=gpt-4#%D0%B2%D0%B8%D0%BA%D0%BE%D1%80%D0%B8%D1%81%D1%82%D0%B0%D0%BD%D0%BD%D1%8F)
- [Опис](https://chat.openai.com/?model=gpt-4#%D0%BE%D0%BF%D0%B8%D1%81)
- [Як це працює](https://chat.openai.com/?model=gpt-4#%D1%8F%D0%BA-%D1%86%D0%B5-%D0%BF%D1%80%D0%B0%D1%86%D1%8E%D1%94)
- [Архітектура](https://chat.openai.com/?model=gpt-4#%D0%B0%D1%80%D1%85%D1%96%D1%82%D0%B5%D0%BA%D1%82%D1%83%D1%80%D0%B0)

## Про проект

Це API, яке надає поточний курс обміну між Bitcoin та українською гривнею (UAH). Воно дозволяє користувачам підписуватися на оновлення курсу та отримувати ці оновлення по електронній пошті.

## Встановлення

1. Склонуйте репозиторій до бажаного місця:

   ```bash
   git clone https://github.com/lumenalux/gses2-app.git gses2-api
   cd gses2-api
   ```

2. Налаштуйте змінні середовища

   Додаток використовує змінні середовища для конфігурації. Встановіть наступні змінні середовища для сервера SMTP та налаштувань електронної пошти:

   ```bash
   export GSES2_APP_SMTP_HOST="<адреса сервера smtp>"
   ```

   ```bash
    export GSES2_APP_SMTP_USER="<ім'я користувача smtp>"
   ```

   ```bash
   export GSES2_APP_SMTP_PASSWORD="<пароль smtp>"`
   ```

   Решта змінних середовища має значення за замовчуванням, що наведено нижче, але їх можна перевизначити, якщо це необхідно:

   - `GSES2_APP_SMTP_PORT="465"`
   - `GSES2_APP_EMAIL_FROM="no.reply@test.info.api"`
   - `GSES2_APP_EMAIL_SUBJECT="Курс обміну BTC на UAH"`
   - `GSES2_APP_EMAIL_BODY="Курс BTC до UAH становить {{.Rate}}"`
   - `GSES2_APP_STORAGE_PATH="./storage/storage.csv"`
   - `GSES2_APP_HTTP_PORT="8080"`
   - `GSES2_APP_HTTP_TIMEOUT="10s"`
   - `GSES2_APP_KUNA_API_URL="https://api.kuna.io/v3/tickers?symbols=btcuah"`
   - `GSES2_APP_KUNA_API_DEFAULT_RATE="0"`

   Змінні середовища включають налаштування сервера SMTP та вміст повідомлень електронної пошти, що відправляються підписникам. Тіло електронного листа розроблено як шаблон з використанням синтаксису text/template Go. Додаток замінює `{{.Rate}}` на поточний курс обміну BTC на UAH перед відправкою електронного листа.

   Щодо налаштувань `email`:

   - `GSES2_APP_EMAIL_FROM`: ця змінна визначає адресу електронної пошти, яка буде відображатися як відправник електронного листа
   - `GSES2_APP_EMAIL_SUBJECT`: ця змінна містить тему електронного листа
   - `GSES2_APP_EMAIL_BODY`: ця змінна містить тіло електронного листа. Будь-яке входження `{{.Rate}}` у це поле буде замінено на поточний курс обміну BTC на UAH при відправці електронного листа

   Якщо ви хочете змінити вміст електронного листа, просто встановіть нові значення для `GSES2_APP_EMAIL_SUBJECT` та/або `GSES2_APP_EMAIL_BODY` за бажанням

   > **Note**
   > Якщо ви бажаєте змінити вміст електронного листа, просто встановіть нові значення для `GSES2_APP_EMAIL_SUBJECT` та/або `GSES2_APP_EMAIL_BODY` за бажанням. Пам'ятайте, що після внесення змін у ці змінні, вам потрібно буде підняти `docker-compose`, щоб застосувати нові налаштування.

   > **Warning**
   > Важливо зберегти заповнювач `{{.Rate}}` у полі `GSES2_APP_EMAIL_BODY`, якщо ви хочете включити поточний курс обміну в електронний лист.

## Використання

1.  Підніміть docker compose:

    ```bash
    docker-compose up --build --detach
    ```

2.  Використання API:

- Отримати поточний курс BTC до UAH:

  ```bash
  curl localhost:8080/api/rate
  ```

- Підписатися на оновлення курсу:

  ```bash
  curl -X POST -d "email=subscriber@email.com" localhost:8080/api/subscribe
  ```

- Надіслати оновлення курсу всім підписникам:

  ```bash
  curl -X POST localhost:8080/api/sendEmails
  ```

## Додатково про використання API

Для докладних прикладів того, як працює API, включно зі скріншотами, будь ласка, перегляньте файл [API_USAGE.md](./docs/API_USAGE.md).

## Опис API

Це API надає три ендпоінти, які виконують різні операції:

1.  **GET** `/api/rate`: Цей ендпоінт використовується для отримання поточного обмінного курсу від BTC до UAH.

2.  **POST** `/api/subscribe`: Цей ендпоінт використовується для додавання нової адреси електронної пошти до списку підписників.

3.  **POST** `/api/sendEmails`: Цей ендпоінт надсилає електронний лист з поточним обмінним курсом від BTC до UAH всім підписникам.

## Як це працює

Файл `main.go` є точкою входу для програми Go. Він створює екземпляри вищезазначених сервісів та впроваджує їх у `controller`. Потім він співставляє методи контролера на HTTP-ендпоінти та запускає сервер.

## Архітектура

1.  **Ініціалізація додатка** **(**`main.go`**)**: Це ентріпоінт додатка. Він ініціалізує всі необхідні сервіси, впроваджує їх в контролер, прив'язує методи контролера до ендпоінтів HTTP та запускає сервер. Це відзначає початок життєвого циклу додатка

2.  **Controller**: Він знаходиться безпосередньо під **Ініціалізацією додатка**. Контролер відповідає за впровадження методів сервісів, а також за обробку HTTP-запитів.

3.  **Сервіси**:

    - **Rate Service**: Цей сервіс відповідає за отримання поточного курсу BTC до UAH з API Kuna. Він також відповідає за конвертацію даних, отриманих від Kuna, в формат, який використовує наш додаток.
    - **Sender Service**: Цей сервіс відповідає за надсилання електронних листів. Він використовує різні механізми, наприклад, провайдера електронної пошти, який зв'язується із зовнішнім SMTP-сервером для надсилання листів, або `stub` для тестування.
    - **Subscribtion Service**: Цей сервіс відповідає за збереження та отримання адрес електронної пошти підписників. Він використовує локальне сховище файлів для зберігання цих даних.

4.  **Додаткові компоненти**:

    - **Storage (CSV)**: механізм зберігання, який використовується Службою підписки для відстеження передплатників. Він використовує файл CSV для зберігання

    - **Transport**: Керує маршрутизацією API за допомогою **Controller**

Ця архітектура забезпечує роздподіл відповідальності, коли кожен компонент зосереджується на певній завдачі. Це розділення дозволяє спростити технічне обслуговування та покращити масштабованість, оскільки зміни в одному компоненті не повинні впливати на інші. Крім того, використання `stub` дозволяє легше проводити тестування, ізолюючи логіку програми від зовнішніх залежностей
